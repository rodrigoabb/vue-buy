<template>
  <main class="product-page">
    <div class="container">
      <div v-if="allProductsStatus.isLoading || fakeIsLoading">
        <LoadingSpinner :spinnerType=1 />
      </div>
      <div v-else-if="allProductsStatus.error" class="error product-list-error">
        <p>{{ allProductsStatus.error }}</p>
      </div>
      <div v-else>
        <ul class="product-list">
            <li class="product-list__item" v-for="product in productsForThisPage" :key="product.uuid">
              <ProductItem
                :product="product"
                @onAddToCart="addProductToCart"
                @onRemoveToCart="removeProductFromCart"
                @onAddToWishlist="addProductToWishlist"
                @onRemoveToWishlist="removeProductFromWishlist"
                />
            </li>
        </ul>
      </div>
    </div>
  </main>
</template>

<script>
import { mapGetters, mapActions } from 'vuex';
import ProductItem from '@/components/Product/ProductItem.vue';
import { PRODUCTS_PER_PAGE, FAKE_WAIT_TIME_MS } from '@/utilities/constants';
import LoadingSpinner from '@/components/Utils/LoadingSpinner.vue';

export default {
  name: 'ProductListPage',
  components: {
    LoadingSpinner,
    ProductItem,
  },
  created() {
    this.askForThisPageProducts();
  },
  data() {
    return {
      currentPage: 1,
      fakeIsLoading: false,
    };
  },
  computed: {
    ...mapGetters([
      'allProducts',
      'allProductsStatus',
    ]),
    productsForThisPage() {
      const productsForThisPage = this.allProducts.slice(this.firstProductGlobalIndex, this.firstProductGlobalIndex + PRODUCTS_PER_PAGE);
      return productsForThisPage;
    },
    firstProductGlobalIndex() {
      return (this.currentPage - 1) * PRODUCTS_PER_PAGE; // -1 for refer to a zero-indexed array
    },
  },
  methods: {
    ...mapActions([
      'fetchProducts',
      'addProductToCart',
      'removeProductFromCart',
      'addProductToWishlist',
      'removeProductFromWishlist',
    ]),
    askForThisPageProducts() {
      this.fakeIsLoading = true;
      setTimeout(() => {
        this.fakeIsLoading = false;
      }, FAKE_WAIT_TIME_MS);
      if (!this.allProducts[this.firstProductGlobalIndex]) {
        this.fetchProducts(this.firstProductGlobalIndex);
      }
    },
  },
};

</script>

<style lang="scss">

/* ==========================================================================
   Product List
   ========================================================================== */

.product-list {
  display: flex;
  flex: 0 1 auto;
  flex-flow: row wrap;
  margin: 0 -10px;
}

.product-list__item {
  padding: 10px;
  flex: 1 0 33.3333%;
  max-width: 33.3333%;
}

.product-page {
  /* height: 100%; */
  height: fit-content;
  min-height: 80vh;
  /* min-height: 100%; */
}

.product-list-error {
  text-align: center;
  line-height: 90px
}

/* ==========================================================================
   Product
   ========================================================================== */

.product {
  display: flex;
  flex-direction: column;
  height: 100%;
  background-color: #ffffff;
}

</style>
